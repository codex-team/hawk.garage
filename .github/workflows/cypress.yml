name: Cypress testing

on: [push]

jobs:
  e2e:
    runs-on: ubuntu-latest

    container:
      image: cypress/browsers:node14.16.0-chrome89-ff86

    services:
      mongodb:
        image: mongo
        ports:
          - 27017:27017

      rabbitmq:
        image: rabbitmq:3-management
        ports:
          - 15672:15672

      api:
        image: codexteamuser/hawk-api:stage
        ports:
          - 4000:4000
        env:
          NODE_ENV: e2e

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v2

      - name: Install deps
        run: yarn

      - name: Cypress run
        uses: cypress-io/github-action@v2
        with:
          browser: chrome
          start: yarn serve
          config_file: cypress.e2e.json
          env: VUE_APP_API_ENDPOINT=http://api:4000,VUE_APP_CLOUDPAYMENTS_PUBLIC_ID=test_api_00000000000000000000001

